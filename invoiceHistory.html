<!DOCTYPE html>
 <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Responsive Admin Dashboard Template">
    <meta name="keywords" content="admin,dashboard">
    <meta name="author" content="stacks">
    <!-- The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    
    <!-- Title -->
    <title>Car Work Shop</title>

    <!-- Styles -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900&display=swap" rel="stylesheet"> -->
    <link href="assets/css/materialIcon.css" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/plugins/font-awesome/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="node_modules/datatables.net-dt/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="sweetalert2.min.css">
    <!-- Theme Styles -->
    <link href="assets/css/lime.min.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
       <!-- <script> var baseUrl="https://mainterior.pk/erpapi/old"; </script> -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>   

<div class="lime-container">
    <div class="lime-body">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class=" ">
                        <div class="card-body">
                            <div class="dashboard-info row">
                                
                               
                            </div>
                        </div>
                    </div>
                </div>      
                <div class="col-md-4">
                    
                        <div class="card-body">
                            <div class="">
                                
                            </div>
                        </div>
                    </div>

            </div>
            <div class="lime-container">
    <div class="lime-body">
        <div class="container" style="margin-top: 40px;">
            <div class="row">
                <div class="col-md-12">
                    <div class="page-title">
                        <nav aria-label="breadcrumb">
                          
                        </nav>
                        <a><i class="fa fa-arrow-left" id="back" style="font-size: larger; cursor: pointer; display: inline; font-weight: 400px; margin-top: 10px;  margin-left: 20px; "></i></a>

                        <h3 style="display: inline;">Invoice History</h3>
                    </div>
                </div>
            </div>
           
                        
<div class="container" style="margin-top: 20px;">
            <div class="row" id='ahsan'>
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body ">
                            
                            <div class="table-responsive">
                                <table class="table bg-info " id='myTable'>
                                    <thead  >
                                        <tr class="text-white">
                                            <th scope="col">Invoice No</th>
                                            <th scope="col">Customer Name</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Action</th>
                                        
                                        </tr>
                                    </thead>
                                    <tbody id='table_data' onload=asyncCall()>

                                    </tbody>
                                    <!-- <tfoot >
                                        <tr class="text-white">
                                            <th colspan="4">Total</th>
                                            <th id="total_debit" colspan="1"></th>
                                            <th id="total_credit" colspan="2"></th>
                                        </tr>
                                    </tfoot> -->
                                </table>
                            </div>      
                        </div>
                    </div>
                </div>
            </div>
        </div>       
                
<div class="modal fade" id="viewModal">
<div class="modal-dialog modal-lg  modal-dialog-centered">
<div class="modal-content"id='model-edit'>

<!-- Modal Header -->
<div class="modal-header">
  <h4 class="modal-title" >Transaction Details</h4>
  <button type="button" class="close" data-dismiss="modal">&times;</button>
</div>

<!-- Modal body -->
<div class="modal-body" >
    <div id="mb" style="padding: 25px; " > 
        <div class="form-row text-center " style="border:solid; border-bottom-right-radius: 25px;  border-top-left-radius: 25px; color:#707baa;  font-style: italic; font-style: bold;  font-family: Times New Roman; margin-left: 20px;margin-right: 20px;margin-top: 20px;">
            <div class="form-group col-sm-4 text-right" style="font-size:40pt;">
              M.A.
            </div>
            <!-- <div class="form-group col-sm-2" style="background:url(https://mainterior.pk/erp/view/logo.png); background-size:contain; background-repeat: no-repeat;"></div> -->
            <div class="form-group col-sm-6 text-left" style="font-size:40pt;">INTERIORS
            </div>
        </div>
          <div class="text-center" style="font-size:20pt; color:black;">
            Quality Furnitures & Interior Decorators 
          </div>  <br> 
          <div class="container"> 
          <div class="form-row" style="margin-left: 20px;margin-right: 20px;font-size:large" >
<div class="form-group col-sm-3" id="input-date" >
<b><label for="date" style="color:black;">Date:</label></b>
</div>
<div class="form-group col-sm-3" id="input-date">
<label  id="date1" value="text"  class="text-muted pl-2"></label>
</div>
<div class="form-group col-sm-2" id="cont">
<b><label id="to_from"for="contractor" style="color:black;" >TO:</label></b>
</div>
<div class="form-group col-sm-4" id="cont">
<label  id="to" value="contract" class="text-muted pl-2"></label>
</div>
</div>
<div class="form-row" style="margin-left: 20px;margin-right: 20px; font-size:large">
<div class="form-group col-sm-3" id="pay-mode">
<b><label for="contractor" style="color:black;">Payment Mode:</label></b>
</div>
<div class="form-group col-sm-3" id="pay-mode">
<label  id="pay1"value="pay" class="text-muted pl-2"></label>
</div>
<div class="form-group col-sm-2" id="b-name">
<b><label for="contractor" style="color:black;">Bank Name:</label></b>
</div>
<div class="form-group col-sm-4" id="b-name">
<label id="bn_1" value="bName" class="text-muted pl-2"></label>
</div>
</div>
<div class="form-row" style="margin-left: 20px;margin-right: 20px; font-size:large" >
<div class="form-group col-sm-3" id="cheque-no">
<b><label for="contractor" style="color:black;">Cheque No:</label></b>
</div>
<div class="form-group col-sm-3" id="cheque-no">
<label id="c_1"value="cNo" class="text-muted pl-2"></label>
</div>
<div class="form-group col-sm-3 cheque-date">
<b><label for="contractor"style="color:black;" >Cheque Date:</label></b>
</div>
<div class="form-group col-sm-3 cheque-date">
<label id="CD" value="cDate" class="text-muted pl-2"></label>
</div>
</div>
<div class="form-row" style="margin-left: 20px;margin-right: 20px; font-size:large">
<div class="form-group col-sm-3 transfer_id" >
<b><label for="contractor" style="color:black;">Transfer Id:</label></b>
</div>
<div class="form-group col-sm-3 transfer_id" >
<label id="transac_1" value="transId" class="text-muted pl-2"></label>
</div>
<div class="form-group col-sm-3" id="input-pay">
<b><label for="payment" style="color:black;">Amount:</label></b>
</div>
<div class="form-group col-sm-3" id="input-pay">
<label id="amount1" value="amount" class="text-muted pl-2" ></label>
</div>
</div>
</div>  <br><br><hr>
<div class="form-row text-center" style="margin-left: 20px;margin-right: 20px;margin-bottom: 20px;">
<div class="form-group col-sm-12 text-center" style="font-size:13pt; color:black;">
Plot No .474, Street No.60 SECTOR-G, CH.Rehmat Ali Road,<br>
Manzoor Colony, Karachi, Phone:021-35 94461<br>
EMAIL: ma_interiors@hotmail.com
</div>
</div>

    </div>

<!-- Modal footer -->
<div class="modal-footer justify-content-center">
    
  <!-- <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button> -->
  <button type="button" class="btn btn-info" onclick="print_slip('mb')">Print</button>
</div>


</div>
</div>
</div>        
</div>
</span>  

<script>window.$ = window.jQuery = require('./assets/plugins/jquery/jquery-3.1.0.min.js');</script>
<!-- <script>window.richText=window.rich=require("./assets/plugins/jquery/jquery.richtext.js")</script> -->
<!-- <script src="./assets/plugins/jquery/jquery-3.1.0.min.js"> </script> -->
<!-- <script src="./assets/plugins/jquery/jquery.richtext.min.js"></script>
<script>window.mask=window.mask1=require('./assets/plugins/jquery/mask.js')</script> -->

<!-- <script> window.DataTable= window.data =require('./assets/plugins/jquery/datatable.min.js')</script>
<script> window.DataTable1=window.tb =require('./assets/plugins/jquery/datatable1.min.js')</script>
<script>window.Print=window.pr=require('./assets/plugins/jquery/print.min.js')</script>
<script>window.DataTable2=window.tb1=require('./assets/plugins/jquery/datatable2.min.js')</script> -->
<!-- <script>window.pdf=window.pd=require('./assets/plugins/jquery/pdf.min.js')</script> -->
<!-- <script>window.cloud=window.flare=require('./assets/plugins/jquery/cloudflare.min.js')</script>
<script>window.cloud1=window.flare1=require('./assets/plugins/jquery/cloudflare1.min.js')</script> -->


<!-- <script>window.sum=window.sum1=require('./assets/plugins/jquery/sum.min.js')</script> -->
 
    <!-- <script>

            $(document).ready( function () {
            } );

        // $('#to_hide').hide();        
                var table=0;
            loadTable();
            function loadTable() {
// alert("ahsan")
table= $('#myTable').DataTable({

"ajax":baseUrl+"/api/allTransaction/table",
// alert("ahsan")
"order": [[ 0, "desc" ]],
//     drawCallback: function () {
//         var credit = convertToInternationalCurrencySystem($('#myTable').DataTable().column(5).data().sum());
//         var debit = convertToInternationalCurrencySystem($('#myTable').DataTable().column(4).data().sum());

//         // alert(sum)
//         $('#total_debit').html(debit)
//         $('#total_credit').html(credit)
// },
"columns":[
        {"data": "tran_id"},
        {"data": "description"},
        {"data": "tran_date"},
        {"data": "payment_mode"},
        {"data": "debit_amount"},
        {"data": "credit_amount"},

        {
        // className: "dt-center",
        "data": null,
        // drawCallback:function(){
        //     var api = this.api();
        //     $( api.table().footer() ).html(
        //         api.column(4).data().sum()
        //     );
        //         },
        render:function(data, type, row)
            {
                return '<a onclick="view('+data["tran_id"]+')"><i class="fa fa-eye m-3 text-info"></i></a> <a onclick=del("transaction",' +data["tran_id"]+',"#myTable")><i class="fa fa-trash m-2 text-danger"></i><a>';
            },
        // defaultContent: '<i class="fa fa-eye m-3" onclick="view('++'"/> ' ,
        // orderable: false
        "targets": -1

    }
    
    
    
        // {"data": "tran_amount"},
        // {"data": "contractor"}
        // {"data": "balance"}
        // {"data":"payment_spend"}

        // {"data": "company_id"},
        // {"data": "company_id"},
    ],
          "columnDefs": [
    {
        "targets": [ 0 ],
        "visible": false,
        "searchable": false
    }
],
"footerCallback": function ( row, data, start, end, display ) {
    var api = this.api(), data;
    var intVal = function ( i ) {
        return typeof i === 'string' ?
            i.replace(/[\$,]/g, '')*1 :
            typeof i === 'number' ?
                i : 0;
    };
    // Total over all pages
    
    total_debit = api
        .column( 4 )
        .data()
        .reduce( function (a, b) {
            return intVal(a) + intVal(b);
        }, 0 );
        total_credit = api
        .column( 5 )
        .data()
        .reduce( function (a, b) {
            return intVal(a) + intVal(b);
        }, 0 );
    // Total over this page
    pageTotalcredit = api
        .column( 5, { page: 'current'} )
        .data()
        .reduce( function (a, b) {
            return intVal(a) + intVal(b);
        }, 0 );
    pageTotalDebit = api
        .column( 4, { page: 'current'} )
        .data()
        .reduce( function (a, b) {
            return intVal(a) + intVal(b);
        }, 0 );
        total=convertToInternationalCurrencySystem(total_debit)
        var debit=convertToInternationalCurrencySystem(pageTotalDebit)
        total_credit=convertToInternationalCurrencySystem(total_credit)
        var credit=convertToInternationalCurrencySystem(pageTotalcredit)
    // Update footer
    $( api.column( 4 ).footer() ).html(
        debit +' ('+ total +')'
    );
    $( api.column( 5 ).footer() ).html(
        credit +' ('+ total_credit +')'
    );
}

});
}
function print_slip(divName){

var printContents = document.getElementById(divName).innerHTML;
var originalContents = document.body.innerHTML;

document.body.innerHTML = printContents;
document.body.style.backgroundColor = "white"; 
window.print();

location.reload();

}
function view(id){
// alert(id)
var paymentmode=null
$.ajax({
    url:  baseUrl + "/api/single/transaction/" + id,
    type:"get",
    success:function(result){
        console.log(result);
        if(result.tran_id!=null){
            if(result.cheque_num!=null){
                $('#cheque-no').show()
                $('.cheque-date').show() 
                $('.transfer_id').hide() 
                paymentmode="cheque"


            }
            else if(result.transfer_id!=null){
                $('.transfer_id').show() 
                $('#cheque-no').hide()
                $('.cheque-date').hide() 
                paymentmode="transfer"

            }
            else{
                $('#cheque-no').hide()
                $('.cheque-date').hide() 
                $('.transfer_id').hide() 
                paymentmode="cash"

            }
            if(result.cust_type=="transfer"){
                $('#input-pro').hide()

            }
            else if(result.cust_type=="employee_salary"){
                $('pro_label').hide();
            }
            else{
                $('#input-pro').show()

            }
            if(result.tran_type=="credit"&& result.cust_type=="project"){
                $('#to_from').html("From")
            }
            else{
                $('#to_from').html("To")

            }
            $('#date1').html(result.tran_date)
            $('#to').html(result.to_name) 
            $('#pay1').html(paymentmode) 
            $('#bn_1').html(result.bank_name) 
            $('#c_1').html(result.cheque_num) 
            $('#CD').html(result.tran_date) 
            $('#transac_1').html(result.transfer_id) 
            $('#amount1').html(result.tran_amount) 
            $('#pro1').html(result.project_name) 
            $('#viewModal').modal('toggle')
        }
        

    },
    error:function(error){
        console.log(error)
    }
})
}
                
                
                </script> -->
                <script src="node_modules/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
                <script src="sweetalert2.all.min.js"></script>
                <script>
                    $(document).ready(function(){
                        $('#back').on('click',function(){
                         location.replace('dashboard.html');
                         
                       })
                     
                    //    $('#eyepop').on('click',function(){
                    //      location.replace('printslip.html');
                    //    })
                       
                    })
                    require( 'datatables.net-dt' )(window, $);

                   $(document).ready( function () {
                    let db = require("better-sqlite3")('./carWorkshop.db');

const sql=`SELECT * FROM invoice `;
const data_db=db.prepare(sql).all()
console.log(data_db)

db.close()
                    $('#myTable').DataTable({
                        // "pagingType": "full_numbers",
                    "lengthMenu": [
                        [5, 25, 50, -1],
                        [5, 25, 50, "All"]
                    ],
                    // responsive: false,
                    language: {
                        search: "_INPUT_",
                        searchPlaceholder: "Search records",
                    },
                    "data":data_db,
                    "columns": [
                    { "data": "id" },
                { "data": "name" },
                { "data": "Date" },

                {
        // className: "dt-center",
        "data": null,
        // drawCallback:function(){
        //     var api = this.api();
        //     $( api.table().footer() ).html(
        //         api.column(4).data().sum()
        //     );
        //         },
        render:function(data, type, row)
            {
                return '<i class="fa fa-eye m-3 text-info" onclick="invoice('+data["id"]+')"></i> <i class="fa fa-trash m-2  text-danger"onclick=del('+data["id"]+')></i>';
            },
        // defaultContent: '<i class="fa fa-eye m-3" onclick="view('++'"/> ' ,
        // orderable: false
        "targets": -1

    }
            ],
           
                    });
                })
                function invoice(id){
                    // alert(id)
                    localStorage.setItem("is_duplicate","true");
                    localStorage.setItem("invoice_id",id);
                    location.replace("printslip.html")
                }
                function del(id){
                    const Swal = require('sweetalert2')
                    Swal.fire({
                            title: 'Are you sure?',
                            text: "You won't be able to revert this!",
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Delete',
                            confirmButtonColor: "red",
                        }).then((result)=>{
                            if (result.isConfirmed) {
                                let db = require("better-sqlite3")('./carWorkshop.db');
                                const del_sql=`DELETE from invoice_details where invoice_id=${id}`
                                const c=db.prepare(del_sql).run();
                                console.log(c)
                                db.prepare(`DELETE from invoice where id=${id}`).run()
                                location.reload()
                                db.close()

                            }
                        })
                    // alert(id)
                    
                    
                }
          
                    // $('#myTable').DataTable();
                    
                </script>